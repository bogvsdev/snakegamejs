!function(e,t){var i,n,s,r,a,o,l,h,u,d,c=60,f=30,g=0,p=1,v=2,y=3,m=4,w=1,S=2,x=3,k=4,M=37,b=38,_=39,q=40,F=JSON.parse(localStorage.getItem("results"))||[],E=!0,I=50,L=[2,3,4,5,6,7];i={init:function(){this.main()},loop:function(){i.update.call(this),i.draw.call(this)},main:function(){var e=this;r=t.createElement("canvas"),r.width=20*c,r.height=20*f,a=r.getContext("2d"),a.font="12px Open Sans",t.querySelector(".wrap").appendChild(r),o=0,l={},t.addEventListener("keydown",function(e){l[e.keyCode]=!0}),t.addEventListener("keyup",function(e){delete l[e.keyCode]}),t.querySelector("#results").addEventListener("click",function(t){e.showResult(E)}),this.preinit()},preinit:function(){n.init(g,c,f),h=0;var e={x:Math.floor(c/3),y:Math.floor(f/2)};s.init(w,e.x,e.y,I),n.set(p,e.x,e.y),this.changeSpeed(s.speed),this.setFood()},update:function(){if(o++,o%5==0){var e=s.last.x,t=s.last.y;switch(l[M]&&s.direction!==S&&(s.direction=k),l[b]&&s.direction!==x&&(s.direction=w),l[_]&&s.direction!==k&&(s.direction=S),l[q]&&s.direction!==w&&(s.direction=x),s.direction){case w:t--;break;case S:e++;break;case x:t++;break;case k:e--}if(0>e&&(e=n.width-1),e>n.width-1&&(e=0),t>n.height-1&&(t=0),0>t&&(t=n.height-1),n.get(e,t)==v)i.setFood(),h>=5&&i.setWall(),h%2==0&&(s.speed+=20,i.changeSpeed(s.speed)),h++;else if(n.get(e,t)==m)i.removeWalls(),h+=2;else{if(n.get(e,t)==p||n.get(e,t)==y)return i.saveResult(),E=!0,i.showResult(E);var r=s.remove();n.set(g,r.x,r.y)}n.set(p,e,t),s.insert(e,t)}},changeSpeed:function(e){clearInterval(u),u=setInterval(this.loop,1e3/e)},setFood:function(){for(var e=[],t=0;t<n.width;t++)for(var i=0;i<n.height;i++)n.get(t,i)===g&&e.push({x:t,y:i});var s=e[Math.round(Math.random()*(e.length-1))];n.set(v,s.x,s.y),h%5===0&&this.setBonus()},setBonus:function(){for(var e=[],t=0;t<n.width;t++)for(var i=0;i<n.height;i++)n.get(t,i)===g&&e.push({x:t,y:i}),n.get(t,i)===m&&n.set(g,t,i);var s=e[Math.round(Math.random()*(e.length-1))];n.set(m,s.x,s.y)},setWall:function(){for(var e=[],t=0;t<n.width;t++)for(var i=0;i<n.height;i++)n.get(t,i)===g&&e.push({x:t,y:i});for(var s=L[Math.round(Math.random()*(L.length-1))],r=Math.round(Math.random()*(e.length-1)),a=0;s>a;a++){var o=void 0==e[r+a]?e[r-a]:e[r+a];s%2==0?n.set(y,e[r].x,o.y):n.set(y,o.x,e[r].y)}},removeWalls:function(){for(var e=0;e<n.width;e++)for(var t=0;t<n.height;t++)n.get(e,t)===y&&n.set(g,e,t)},draw:function(){for(var e=r.width/n.width,t=r.height/n.height,i=0;i<n.width;i++)for(var s=0;s<n.height;s++){switch(n.get(i,s)){case g:a.fillStyle="#E4F7FF";break;case p:a.fillStyle="#0ff";break;case v:a.fillStyle="#f00";break;case y:a.fillStyle="#0F0";break;case m:a.fillStyle="#00F"}a.fillRect(i*e,s*t,e,t)}a.fillStyle="#000",a.fillText("Score: "+h,20,20)},saveResult:function(){var e=prompt("Good job! Lets save your result. What is your name?");null!=e&&(F.push({name:e,score:h}),localStorage.setItem("results",JSON.stringify(F)),this.preinit())},showResult:function(e){var i=t.getElementById("restable");if(e){t.querySelector("#results").innerHTML="Hide results",i.style.display="block";var n="<h2>Results</h2>",s=JSON.parse(localStorage.getItem("results"))||"No data";"No data"!=s?s.forEach(function(e){n+="<span>Name: "+e.name+". Score: "+e.score+"</span><br />"}):n=s,i.innerHTML=n,this.pauseGame(!0)}else t.querySelector("#results").innerHTML="Show results",i.style.display="none",this.pauseGame(!1);E=!E},pauseGame:function(e){d=s.speed,e?clearInterval(u):this.changeSpeed(d)}},n={width:null,height:null,_grid:null,init:function(e,t,i){this.width=t,this.height=i,this._grid=[];for(var n=0;t>n;n++){this._grid.push([]);for(var s=0;i>s;s++)this._grid[n].push(e)}},set:function(e,t,i){this._grid[t][i]=e},get:function(e,t){return this._grid[e][t]}},s={direction:null,last:null,_queue:null,speed:null,init:function(e,t,i,n){this.direction=e,this.speed=n,this._queue=[],this.insert(t,i)},insert:function(e,t){this._queue.unshift({x:e,y:t}),this.last=this._queue[0]},remove:function(){return this._queue.pop()}},i.init()}(window,this.document);